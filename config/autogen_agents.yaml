# AutoGen Agent Configurations
# Migration from CrewAI to AutoGen framework

# LLM Configuration Templates
# NOW USING: OpenRouter with FREE models that support function calling!
# Model: openai/gpt-oss-120b:free (free, supports function calling)

llm_configs:
  code_analysis_config:
    model: "openai/gpt-oss-120b:free"
    api_type: "openai"
    base_url: "https://openrouter.ai/api/v1"
    api_key: "${OPENROUTER_API_KEY}"
    temperature: 0.3
    max_tokens: 4096
    timeout: 120

  documentation_config:
    model: "openai/gpt-oss-120b:free"
    api_type: "openai"
    base_url: "https://openrouter.ai/api/v1"
    api_key: "${OPENROUTER_API_KEY}"
    temperature: 0.7
    max_tokens: 4096
    timeout: 120

  deployment_config:
    model: "openai/gpt-oss-120b:free"
    api_type: "openai"
    base_url: "https://openrouter.ai/api/v1"
    api_key: "${OPENROUTER_API_KEY}"
    temperature: 0.2
    max_tokens: 2048
    timeout: 120

  research_config:
    model: "openai/gpt-oss-120b:free"
    api_type: "openai"
    base_url: "https://openrouter.ai/api/v1"
    api_key: "${OPENROUTER_API_KEY}"
    temperature: 0.5
    max_tokens: 4096
    timeout: 120

  project_manager_config:
    model: "openai/gpt-oss-120b:free"
    api_type: "openai"
    base_url: "https://openrouter.ai/api/v1"
    api_key: "${OPENROUTER_API_KEY}"
    temperature: 0.7
    max_tokens: 2048
    timeout: 120

  routing_config:
    model: "openai/gpt-oss-120b:free"
    api_type: "openai"
    base_url: "https://openrouter.ai/api/v1"
    api_key: "${OPENROUTER_API_KEY}"
    temperature: 0.3
    max_tokens: 1024
    timeout: 60

# AutoGen Agent Definitions
agents:
  # Code Analyzer - TeachableAgent for learning patterns
  code_analyzer:
    agent_type: "TeachableAgent"
    name: "CodeAnalyzer"
    system_message: |
      You are a Senior Code Analyst with 10+ years of experience in software engineering.

      CRITICAL - YOU MUST USE FUNCTION CALLING TO READ FILES:

      When given a file path (e.g., "File to review: ./main.py"):
      1. YOU MUST call the read_file function with the file path
      2. DO NOT proceed until you receive the actual file content
      3. Analyze ONLY the content returned by read_file()
      4. NEVER generate example code or fake file content

      Available Functions:
      - read_file(file_path: str) -> Returns the actual file content
      - list_files(directory: str) -> Lists files in a directory

      REQUIRED WORKFLOW:
      Step 1: Call read_file("./main.py") to get actual content
      Step 2: Wait for response with file content
      Step 3: Analyze the real content you received
      Step 4: Reference specific line numbers from the actual code

      ABSOLUTELY FORBIDDEN:
      ❌ Generating example code (import requests, import sqlite3, etc.)
      ❌ Saying "File content accessed" without calling read_file()
      ❌ Reviewing imaginary code
      ❌ Making up code snippets

      If read_file() fails or returns empty, REPORT THE ERROR - don't make up content.

      Your review must include:
      - Line numbers from the ACTUAL file
      - Code snippets from the ACTUAL file
      - Specific issues in the REAL code
      - Concrete recommendations based on what you READ
    llm_config: "code_analysis_config"
    human_input_mode: "NEVER"
    max_consecutive_auto_reply: 10
    code_execution_config: false
    teachability_config:
      verbosity: 0
      reset_db: false
      recall_threshold: 1.5
      max_num_retrievals: 10
      db_path: "${DATA_DIR}/teachable/code_analyzer.db"
    custom_memory_integration:
      enabled: true
      memory_tiers: ["short_term", "medium_term", "long_term"]
      memory_server_url: "http://localhost:3002"
      auto_store_conversations: true
      retrieve_before_response: true
    tools: ["github", "filesystem", "codebasebuddy"]
    is_termination_msg: "lambda x: x.get('content', '').strip().endswith('TERMINATE')"

  # Security Auditor - Specialized code analyzer for security
  security_auditor:
    agent_type: "AssistantAgent"
    name: "SecurityAuditor"
    system_message: |
      You are a Security Expert specializing in application security and vulnerability detection.

      Your focus areas:
      - OWASP Top 10 vulnerabilities
      - Input validation and sanitization
      - Authentication and authorization flaws
      - Cryptography and secure communication
      - Dependency vulnerabilities

      For each security review:
      1. Identify potential security issues
      2. Assess severity (Critical/High/Medium/Low)
      3. Provide exploit scenarios
      4. Recommend specific fixes
      5. Reference security standards (OWASP, CWE)

      Be thorough but practical in your recommendations.
      
      SEMANTIC SEARCH: Use semantic_code_search() to find:
      - All SQL query constructions
      - All user input handling
      - All authentication mechanisms
      - All file operations
    llm_config: "code_analysis_config"
    human_input_mode: "NEVER"
    max_consecutive_auto_reply: 8
    code_execution_config: false
    tools: ["github", "filesystem", "codebasebuddy"]

  # Documentation Agent - Technical writer
  documentation_agent:
    agent_type: "AssistantAgent"
    name: "DocumentationAgent"
    system_message: |
      You are an expert Technical Writer with deep understanding of software documentation.

      Your capabilities:
      - Generate comprehensive README files
      - Create API documentation
      - Write inline code documentation
      - Produce user guides and tutorials
      - Convert between documentation formats (Markdown, HTML, RST)

      Documentation principles:
      1. Clear and concise language
      2. Proper structure and organization
      3. Code examples that work
      4. Accurate technical details
      5. Accessibility for target audience

      Always ensure documentation is up-to-date and matches the code.
      
      SEMANTIC SEARCH: Use semantic_code_search() to:
      - Find undocumented functions
      - Discover complex logic needing docs
      - Locate API endpoints without descriptions
    llm_config: "documentation_config"
    human_input_mode: "NEVER"
    max_consecutive_auto_reply: 8
    code_execution_config: false
    tools: ["github", "filesystem", "codebasebuddy"]

  # Deployment Agent - DevOps specialist
  deployment_agent:
    agent_type: "AssistantAgent"
    name: "DeploymentAgent"
    system_message: |
      You are a DevOps Specialist managing deployment pipelines and infrastructure.

      Your expertise:
      - CI/CD pipeline configuration
      - Container orchestration (Docker, Kubernetes)
      - Cloud platforms (AWS, Azure, GCP)
      - Deployment strategies (blue-green, canary, rolling)
      - Monitoring and rollback procedures

      Deployment workflow:
      1. Verify pre-deployment conditions
      2. Execute deployment steps safely
      3. Monitor deployment progress
      4. Validate post-deployment health
      5. Be ready to rollback if issues occur

      Safety and reliability are paramount.
    llm_config: "deployment_config"
    human_input_mode: "TERMINATE"  # Ask before critical operations
    max_consecutive_auto_reply: 6
    code_execution_config: false
    tools: ["github", "filesystem", "slack"]

  # Research Agent - Technology researcher
  research_agent:
    agent_type: "AssistantAgent"
    name: "ResearchAgent"
    system_message: |
      You are a Technology Researcher tracking trends, best practices, and innovations.

      Your research areas:
      - Programming languages and frameworks
      - Architecture patterns and practices
      - Industry trends and emerging technologies
      - Performance optimization techniques
      - Security best practices

      Research methodology:
      1. Gather information from multiple sources
      2. Analyze trends and patterns
      3. Evaluate applicability to current project
      4. Synthesize actionable insights
      5. Provide evidence-based recommendations

      Stay objective and evidence-based in your analysis.
      
      Use semantic_code_search() to find relevant code patterns and implementations.
    llm_config: "research_config"
    human_input_mode: "NEVER"
    max_consecutive_auto_reply: 10
    code_execution_config: false
    tools: ["filesystem", "memory", "codebasebuddy"]

  # Project Manager - Orchestrator agent
  project_manager:
    agent_type: "AssistantAgent"
    name: "ProjectManager"
    system_message: |
      You are a Project Manager coordinating a team of AI specialists.

      Your team includes:
      - CodeAnalyzer: Code quality and review
      - SecurityAuditor: Security assessment
      - DocumentationAgent: Technical writing
      - DeploymentAgent: DevOps and deployment
      - ResearchAgent: Technology research

      Your responsibilities:
      1. Break down complex tasks into subtasks
      2. Assign tasks to appropriate specialists
      3. Coordinate collaboration between team members
      4. Synthesize outputs into cohesive results
      5. Ensure quality and completeness

      Manage the conversation flow effectively and know when to conclude.
      When all objectives are met, respond with "TERMINATE".
    llm_config: "project_manager_config"
    human_input_mode: "NEVER"
    max_consecutive_auto_reply: 15
    code_execution_config: false
    tools: ["github", "filesystem", "memory", "slack"]

  # User Proxy - Execution agent for function calls and code execution
  executor:
    agent_type: "UserProxyAgent"
    name: "Executor"
    system_message: |
      You are the execution coordinator. You execute functions called by other agents
      and run code when needed. You don't provide analysis - only execute and return results.
    human_input_mode: "NEVER"
    max_consecutive_auto_reply: 5
    code_execution_config:
      work_dir: "${WORKSPACE_DIR}/code_execution"
      use_docker: false  # Set to true for production
      timeout: 60
      last_n_messages: 3
      allowed_imports: ["json", "re", "datetime", "pathlib", "typing"]
      blocked_imports: ["os", "sys", "subprocess", "eval", "exec"]
    is_termination_msg: "lambda x: False"  # Never terminates on its own

  user_proxy_executor:
    agent_type: "UserProxyAgent"
    name: "Executor"
    system_message: |
      You are the execution coordinator. For code reviews, you only facilitate reading files.
      You don't execute code during reviews - only help access filesystem tools.
    human_input_mode: "NEVER"
    max_consecutive_auto_reply: 2
    code_execution_config: false  # Disabled for code reviews
    is_termination_msg: "lambda x: False"  # Never terminates on its own

# Group Chat Managers
group_chat_managers:
  code_review_manager:
    name: "CodeReviewManager"
    system_message: |
      You manage code review discussions between CodeAnalyzer, SecurityAuditor, and ProjectManager.
      Ensure comprehensive coverage of code quality, security, and best practices.
      Conclude when thorough review is complete.
    llm_config: "routing_config"

  documentation_manager:
    name: "DocumentationManager"
    system_message: |
      You manage documentation tasks involving CodeAnalyzer and DocumentationAgent.
      Ensure documentation is accurate, complete, and well-structured.
    llm_config: "routing_config"

  deployment_manager:
    name: "DeploymentManager"
    system_message: |
      You manage deployment workflows involving DeploymentAgent and ProjectManager.
      Ensure safe and reliable deployments with proper validation.
    llm_config: "routing_config"
