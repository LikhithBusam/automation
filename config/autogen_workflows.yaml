# AutoGen Workflow Configurations
# Conversation-based workflow patterns

workflows:
  # Code Analysis Workflow
  code_analysis:
    type: "group_chat"
    group_chat_config: "code_review_chat"
    description: "Comprehensive code quality and security analysis"
    initial_message_template: |
      Analyze the code at: {code_path}

      Please review:
      - Code quality and maintainability
      - Security vulnerabilities
      - Performance considerations
      - Best practices compliance
      {additional_requirements}

      Provide specific findings with line numbers and actionable recommendations.
      When analysis is complete, end with: CODE_REVIEW_COMPLETE
    message_variables:
      code_path: "${CODE_PATH}"
      additional_requirements: "${ADDITIONAL_REQUIREMENTS}"
    max_turns: 20
    termination_keywords: ["CODE_REVIEW_COMPLETE", "TERMINATE"]
    human_input_required: false
    summary_method: "reflection_with_llm"
    summary_prompt: |
      Summarize the code review findings:
      - Key issues identified
      - Security concerns
      - Recommendations
      - Priority actions

  # Security Audit Workflow
  security_audit:
    type: "group_chat"
    group_chat_config: "security_audit_chat"
    description: "Deep security vulnerability assessment"
    initial_message_template: |
      Perform a comprehensive security audit on: {project_path}
      Scope: {scope}

      IMPORTANT - USE THESE FUNCTIONS TO ACCESS FILES:
      1. First call: list_directory("{project_path}") to see available files
      2. Then call: read_file("path/to/file.py") for each file you need to analyze
      
      DO NOT use bash, ls, or shell commands. Use ONLY the registered functions.

      Focus areas:
      - OWASP Top 10 vulnerabilities
      - Authentication and authorization
      - Input validation
      - Data protection
      - Dependency vulnerabilities

      After analyzing, provide severity ratings and remediation guidance.
      When complete, end with: SECURITY_AUDIT_COMPLETE
    message_variables:
      project_path: "${PROJECT_PATH}"
      scope: "${SCOPE}"
    max_turns: 15
    termination_keywords: ["TERMINATE", "SECURITY_AUDIT_COMPLETE"]
    human_input_required: false
    summary_method: "reflection_with_llm"
    summary_prompt: |
      Provide a security audit summary:
      - Vulnerabilities found (by severity)
      - Exploitability assessment
      - Remediation recommendations
      - Compliance considerations

  # Documentation Generation Workflow (Fast two-agent version)
  documentation_generation:
    type: "two_agent"
    agents: ["documentation_agent", "user_proxy_executor"]
    initiator: "user_proxy_executor"
    description: "Generate comprehensive project documentation"
    initial_message_template: |
      You are a documentation specialist. Generate documentation for this file.

      File: {code_path}

      === FILE CONTENT START ===
      {file_content}
      === FILE CONTENT END ===

      Please generate:
      1. A brief description of what this code does
      2. Key functions/classes and their purposes
      3. Usage examples
      4. Any important notes or caveats

      Format the output as clean Markdown documentation.

      When complete, end with TERMINATE
    message_variables:
      code_path: "${code_path}"
      file_content: "${file_content}"
    max_turns: 5
    termination_keywords: ["TERMINATE", "DOCUMENTATION_COMPLETE"]
    human_input_required: false

  # Deployment Workflow
  deployment:
    type: "group_chat"
    group_chat_config: "deployment_chat"
    description: "Execute deployment to target environment"
    initial_message_template: |
      Deploy application to {environment}

      Configuration:
      - Version: {version}
      - Strategy: {strategy}
      - Tests required: {run_tests}
      - Notifications: {notify}

      Pre-deployment checklist:
      1. Verify tests pass
      2. Check environment readiness
      3. Review deployment plan
      4. Execute deployment
      5. Validate post-deployment

      Proceed with caution. Rollback if issues detected.
    message_variables:
      environment: "${ENVIRONMENT}"
      version: "${VERSION}"
      strategy: "${STRATEGY}"  # blue-green, canary, rolling
      run_tests: "${RUN_TESTS}"
      notify: "${NOTIFY}"
    max_turns: 12
    termination_keywords: ["TERMINATE", "DEPLOYMENT_COMPLETE", "DEPLOYMENT_FAILED"]
    human_input_required: true  # Require approval for production
    human_approval_points:
      - step: "pre_deployment_check"
        prompt: "Approve deployment to {environment}?"
        timeout_seconds: 300
        default_response: "REJECT"
    summary_method: "reflection_with_llm"
    summary_prompt: |
      Deployment summary:
      - Environment: {environment}
      - Status: {status}
      - Duration: {duration}
      - Issues encountered: {issues}
      - Rollback status: {rollback_status}

  # Research Workflow
  research:
    type: "group_chat"
    group_chat_config: "research_chat"
    description: "Research technology topics and best practices"
    initial_message_template: |
      Research topic: {topic}

      Depth: {depth}
      Focus areas:
      - Current trends and adoption
      - Best practices and patterns
      - Pros and cons
      - Applicability to our project
      - Implementation recommendations

      Compile comprehensive, evidence-based findings.
    message_variables:
      topic: "${TOPIC}"
      depth: "${DEPTH}"  # quick, standard, comprehensive
    max_turns: 15
    termination_keywords: ["TERMINATE", "RESEARCH_COMPLETE"]
    human_input_required: false
    summary_method: "reflection_with_llm"
    summary_prompt: |
      Research findings summary:
      - Key insights
      - Recommendations
      - Implementation suggestions
      - Further research needed

  # Simple Two-Agent Workflows
  quick_code_review:
    type: "two_agent"
    agents: ["code_analyzer", "user_proxy_executor"]
    initiator: "user_proxy_executor"
    description: "Quick code review for small changes"
    initial_message_template: |
      You are a senior code reviewer analyzing a file.

      File: {code_path}
      Focus areas: {focus_areas}

      === FILE CONTENT START ===
      {file_content}
      === FILE CONTENT END ===

      Please provide a comprehensive code review covering:
      1. Error handling and edge cases
      2. Security vulnerabilities (SQL injection, XSS, authentication issues)
      3. Performance bottlenecks
      4. Code quality and best practices adherence
      5. Specific line-by-line issues with references

      Rate the overall code quality (1-10) and provide prioritized improvement recommendations.

      When complete, end with TERMINATE
    message_variables:
      code_path: "${code_path}"
      focus_areas: "${focus_areas}"
      file_content: "${file_content}"
    max_turns: 10
    termination_keywords: ["TERMINATE", "REVIEW_COMPLETE"]
    human_input_required: false

  quick_documentation:
    type: "two_agent"
    agents: ["documentation_agent", "user_proxy_executor"]
    initiator: "user_proxy_executor"
    description: "Quick documentation update"
    initial_message_template: |
      Update documentation for: {code_path}
      Type: {doc_type}
    message_variables:
      code_path: "${CODE_PATH}"
      doc_type: "${DOC_TYPE}"
    max_turns: 8
    termination_keywords: ["TERMINATE", "DOCS_UPDATED"]
    human_input_required: false

  # Nested Conversation Workflows
  comprehensive_feature_review:
    type: "nested_chat"
    parent_agent: "project_manager"
    description: "Multi-perspective feature review with sub-tasks"
    child_conversations:
      - name: "code_quality_check"
        type: "two_agent"
        agents: ["code_analyzer", "user_proxy_executor"]
        initial_message: "Analyze code quality for {feature_path}"
        max_turns: 8

      - name: "security_check"
        type: "two_agent"
        agents: ["security_auditor", "user_proxy_executor"]
        initial_message: "Security audit for {feature_path}"
        max_turns: 8

      - name: "documentation_check"
        type: "two_agent"
        agents: ["documentation_agent", "user_proxy_executor"]
        initial_message: "Verify documentation for {feature_path}"
        max_turns: 6

    aggregation_agent: "project_manager"
    aggregation_prompt: |
      Compile comprehensive feature review from:
      - Code quality analysis
      - Security audit
      - Documentation review

      Provide final recommendation: APPROVE, NEEDS_WORK, or REJECT
    message_variables:
      feature_path: "${FEATURE_PATH}"
    termination_keywords: ["TERMINATE", "FEATURE_REVIEW_COMPLETE"]

# Conversation Patterns
conversation_patterns:
  sequential_review:
    description: "Sequential speaker pattern for thorough review"
    pattern: "round_robin"
    order: ["code_analyzer", "security_auditor", "project_manager"]
    repeat: false

  parallel_analysis:
    description: "Multiple concurrent two-agent conversations"
    pattern: "parallel_two_agent"
    conversations:
      - agents: ["code_analyzer", "user_proxy_executor"]
      - agents: ["security_auditor", "user_proxy_executor"]
      - agents: ["documentation_agent", "user_proxy_executor"]
    aggregator: "project_manager"

  dynamic_selection:
    description: "AI selects next speaker based on context"
    pattern: "auto"
    fallback: "round_robin"
    max_consecutive_same_speaker: 2

# Conversation Persistence
conversation_persistence:
  enabled: true
  storage_backend: "sqlite"  # sqlite, postgresql, mongodb
  storage_path: "${DATA_DIR}/conversations"
  auto_save: true
  save_interval_messages: 5
  compression: true
  retention_days: 90

conversation_resume:
  enabled: true
  resume_checkpoint_file: "${DATA_DIR}/checkpoints/latest.json"
  resume_on_failure: true
  clear_on_success: false
